ğŸ› ï¸ è™šæ‹Ÿæœºç½‘ç»œé—®é¢˜ä¿®å¤å¤ç›˜æŒ‡å—ï¼ˆUbuntu 20.04 + VMwareï¼‰
ğŸ“Œ é€‚ç”¨åœºæ™¯
è™šæ‹Ÿæœºä½¿ç”¨æ¡¥æ¥æ¨¡å¼ï¼Œä½†æ— æ³•è·å– IP æˆ–æ— æ³•ä¸ä¸»æœºäº’é€š

NetworkManager æ˜¾ç¤ºè®¾å¤‡â€œæœªæ‰˜ç®¡â€ï¼Œå›¾å½¢ç•Œé¢ç½‘ç»œé€‰é¡¹ç¼ºå¤±

éœ€è¦è®¾ç½®é™æ€ IP å¹¶ä¸ä¸»æœºåŒç½‘æ®µé€šä¿¡

1ï¸âƒ£ æ£€æŸ¥è™šæ‹Ÿæœºç½‘ç»œæ¨¡å¼ä¸ VMware è®¾ç½®
ç›®çš„ï¼šç¡®ä¿æ¡¥æ¥æ¨¡å¼æ­£ç¡®ç»‘å®šåˆ°ç‰©ç†ç½‘å¡ã€‚

ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ VMwareï¼ˆå¦åˆ™æ— æ³•ä¿®æ”¹ç½‘ç»œè®¾ç½®ï¼‰ã€‚

æ‰“å¼€ â€œç¼–è¾‘â€ â†’ â€œè™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨â€ã€‚

æŸ¥çœ‹åˆ—è¡¨ï¼Œç¡®ä¿å­˜åœ¨ VMnet0ï¼Œç±»å‹ä¸º æ¡¥æ¥æ¨¡å¼ã€‚

é€‰ä¸­ VMnet0ï¼Œåœ¨ä¸‹æ–¹ â€œå·²æ¡¥æ¥åˆ°â€ ä¸‹æ‹‰èœå•ä¸­ï¼Œæ‰‹åŠ¨é€‰æ‹©å½“å‰ä¸Šç½‘çš„ç‰©ç†ç½‘å¡ï¼ˆä¾‹å¦‚æ— çº¿ç½‘å¡ Realtek...ï¼‰ï¼Œä¸è¦é€‰â€œè‡ªåŠ¨â€ã€‚

ç‚¹å‡» â€œåº”ç”¨â€ å¹¶ â€œç¡®å®šâ€ã€‚

2ï¸âƒ£ æ£€æŸ¥è™šæ‹Ÿæœºå†…éƒ¨ç½‘ç»œçŠ¶æ€
ç›®çš„ï¼šç¡®è®¤ç½‘å¡çŠ¶æ€å’Œ NetworkManager è¿è¡Œæƒ…å†µã€‚

bash
# æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œæ¥å£çŠ¶æ€
ip addr

# æŸ¥çœ‹ NetworkManager ç®¡ç†çš„è®¾å¤‡çŠ¶æ€
nmcli device status

# æŸ¥çœ‹ NetworkManager æœåŠ¡çŠ¶æ€
systemctl status NetworkManager
é¢„æœŸï¼šens33 çŠ¶æ€åº”ä¸º connected æˆ– connectingï¼›å¦‚æœæ˜¾ç¤º unmanagedï¼Œéœ€è¿›è¡Œä¸‹ä¸€æ­¥ã€‚

3ï¸âƒ£ ä¿®å¤ NetworkManager æœªæ‰˜ç®¡é—®é¢˜
3.1 æ£€æŸ¥ Netplan é…ç½®
Netplan é…ç½®æ–‡ä»¶é€šå¸¸ä½äº /etc/netplan/ã€‚

bash
# åˆ—å‡º Netplan é…ç½®æ–‡ä»¶
ls /etc/netplan/

# æŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼ˆä»¥å®é™…æ–‡ä»¶åä¸ºå‡†ï¼‰
sudo cat /etc/netplan/01-network-manager-all.yaml
ç¡®ä¿å†…å®¹å¦‚ä¸‹ï¼ˆrenderer: NetworkManager ä¸” ens33 é…ç½®äº† DHCPï¼‰ï¼š

yaml
network:
  ethernets:
    ens33:
      dhcp4: true
  version: 2
  renderer: NetworkManager
å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨æˆ–å†…å®¹æœ‰è¯¯ï¼Œç”¨ sudo vim ç¼–è¾‘ä¿®æ­£ï¼Œç„¶ååº”ç”¨ï¼š

bash
sudo netplan apply
3.2 æ£€æŸ¥ NetworkManager çŠ¶æ€æ–‡ä»¶
çŠ¶æ€æ–‡ä»¶å¯èƒ½è®°å½•äº†â€œç½‘ç»œç¦ç”¨â€ï¼Œå¯¼è‡´ NetworkManager ä¸å·¥ä½œã€‚

bash
# æŸ¥çœ‹çŠ¶æ€æ–‡ä»¶
sudo cat /var/lib/NetworkManager/NetworkManager.state
å¦‚æœ NetworkingEnabled=falseï¼Œå°†å…¶æ”¹ä¸º trueï¼š

bash
sudo sed -i 's/NetworkingEnabled=false/NetworkingEnabled=true/' /var/lib/NetworkManager/NetworkManager.state
3.3 é‡å¯ NetworkManager
bash
sudo systemctl restart NetworkManager
3.4 å†æ¬¡æ£€æŸ¥è®¾å¤‡çŠ¶æ€
bash
nmcli device status
è‹¥ä»ä¸º unmanagedï¼ŒæŸ¥çœ‹æ—¥å¿—å¯»æ‰¾åŸå› ï¼š

bash
journalctl -u NetworkManager -f
å¸¸è§åŸå› ï¼š/etc/network/interfaces ä¸­å­˜åœ¨é…ç½®ï¼ˆå³ä½¿æ–‡ä»¶ä¸å­˜åœ¨ä¹Ÿå¯èƒ½æœ‰å½±å“ï¼‰ï¼Œæˆ–å…¶ä»–æœåŠ¡ï¼ˆå¦‚ systemd-networkdï¼‰å ç”¨ã€‚

4ï¸âƒ£ å¦‚æœ NetworkManager å§‹ç»ˆæ— æ³•æ¥ç®¡ â†’ æ”¹ç”¨ systemd-networkd é…ç½®é™æ€ IP
å½“ NetworkManager æ— æ³•ç®¡ç†æ—¶ï¼Œç›´æ¥é€šè¿‡ Netplan + systemd-networkd é…ç½®ç½‘ç»œæ›´ç¨³å®šã€‚

4.1 å¤‡ä»½åŸ Netplan é…ç½®
bash
sudo cp /etc/netplan/01-network-manager-all.yaml /etc/netplan/01-network-manager-all.yaml.bak
4.2 ç¼–è¾‘ Netplan é…ç½®æ–‡ä»¶
bash
sudo vim /etc/netplan/01-network-manager-all.yaml
æ›¿æ¢ä¸ºä»¥ä¸‹å†…å®¹ï¼ˆæ ¹æ®ä½ çš„ç½‘ç»œç¯å¢ƒä¿®æ”¹ IPã€ç½‘å…³ï¼‰ï¼š

yaml
network:
  ethernets:
    ens33:
      dhcp4: no
      addresses:
        - 192.168.2.100/24      # ä½ æƒ³è¦è®¾ç½®çš„é™æ€ IP
      gateway4: 192.168.2.1      # ç½‘å…³åœ°å€ï¼ˆä¸ä¸»æœºç›¸åŒï¼‰
      nameservers:
        addresses: [8.8.8.8, 114.114.114.114]  # DNS æœåŠ¡å™¨
  version: 2
  renderer: networkd             # æ”¹ç”¨ systemd-networkd
4.3 åº”ç”¨é…ç½®
bash
sudo netplan apply
å¦‚æœæç¤º systemd-networkd is not runningï¼Œè¯·å…ˆå¯åŠ¨å®ƒï¼š

bash
sudo systemctl start systemd-networkd
sudo systemctl enable systemd-networkd
sudo netplan apply
4.4 éªŒè¯ç½‘ç»œ
bash
# æŸ¥çœ‹ IP æ˜¯å¦é…ç½®æˆåŠŸ
ip addr show ens33

# æµ‹è¯•ç½‘å…³
ping 192.168.2.1

# æµ‹è¯•å¤–ç½‘
ping 8.8.8.8
æ­¤æ—¶è™šæ‹Ÿæœºåº”èƒ½æ­£å¸¸ä¸Šç½‘ï¼Œä½†å›¾å½¢ç•Œé¢ç½‘ç»œè®¾ç½®å¯èƒ½ä¾æ—§ç®€é™‹ï¼ˆå› ä¸ºä¸å†ä½¿ç”¨ NetworkManagerï¼‰ã€‚

5ï¸âƒ£ ä¸»æœºä¾§æ’æŸ¥ï¼ˆWindowsï¼‰
å¦‚æœè™šæ‹Ÿæœºç½‘ç»œæ­£å¸¸ä½†æ— æ³• ping é€šä¸»æœºï¼Œé—®é¢˜é€šå¸¸å‡ºåœ¨ Windows ç«¯ã€‚

5.1 æ£€æŸ¥ Windows é˜²ç«å¢™
ä¸´æ—¶å…³é—­é˜²ç«å¢™æµ‹è¯•ï¼š
æ§åˆ¶é¢æ¿ â†’ Windows Defender é˜²ç«å¢™ â†’ å¯ç”¨æˆ–å…³é—­é˜²ç«å¢™ â†’ å…¨éƒ¨å…³é—­ã€‚

è™šæ‹Ÿæœºå†æ¬¡ ping ä¸»æœºã€‚è‹¥é€šï¼Œåˆ™éœ€æ·»åŠ  ICMP å…¥ç«™è§„åˆ™ï¼š

æ‰“å¼€â€œé«˜çº§å®‰å…¨ Windows Defender é˜²ç«å¢™â€ã€‚
å…¥ç«™è§„åˆ™ â†’ æ–°å»ºè§„åˆ™ â†’ è‡ªå®šä¹‰ â†’ æ‰€æœ‰ç¨‹åº â†’ åè®®ç±»å‹: ICMPv4 â†’ è‡ªå®šä¹‰ â†’ å‹¾é€‰â€œå›æ˜¾è¯·æ±‚â€ â†’ å…è®¸è¿æ¥ â†’ å…¨é€‰é…ç½®æ–‡ä»¶ â†’ å‘½åå®Œæˆã€‚
5.2 æ£€æŸ¥å¤šä¸ªç½‘ç»œæ¥å£åŒç½‘æ®µå†²çª
åœ¨ Windows å‘½ä»¤æç¤ºç¬¦ä¸­è¿è¡Œï¼š

cmd
ipconfig /all
æŸ¥çœ‹é™¤äº†ç‰©ç†ç½‘å¡ï¼ˆWi-Fi æˆ–æœ‰çº¿ï¼‰å¤–ï¼Œæ˜¯å¦è¿˜æœ‰å…¶ä»–é€‚é…å™¨ï¼ˆå¦‚ VMware Virtual Ethernet Adapterï¼‰ä¹Ÿè·å¾—äº† 192.168.2.x çš„ IPã€‚

å¦‚æœæœ‰ï¼Œå¯ä»¥ç¦ç”¨è¯¥é€‚é…å™¨ï¼ˆæ§åˆ¶é¢æ¿ â†’ ç½‘ç»œè¿æ¥ â†’ å³é”®ç¦ç”¨ï¼‰æˆ–ä¿®æ”¹å…¶ IP ä¸ºå…¶ä»–ç½‘æ®µï¼ˆå¦‚ 192.168.99.1ï¼Œæ©ç  255.255.255.0ï¼Œç½‘å…³ç•™ç©ºï¼‰ã€‚

5.3 éªŒè¯äº’é€š
bash
# è™šæ‹Ÿæœº ping ä¸»æœº
ping 192.168.2.153   # æ›¿æ¢ä¸ºä½ çš„ä¸»æœºå®é™… IPï¼ˆä» ipconfig è·å–ï¼‰

# ä¸»æœº ping è™šæ‹Ÿæœº
ping 192.168.2.100
6ï¸âƒ£ æœ€ç»ˆéªŒè¯ä¸æŒä¹…åŒ–
é‡å¯è™šæ‹Ÿæœºï¼Œæ£€æŸ¥ IP æ˜¯å¦ä¾ç„¶å­˜åœ¨ï¼šip addr show ens33

ç¡®è®¤èƒ½ ping é€šå¤–ç½‘å’Œä¸»æœºã€‚

è‹¥ä¸€åˆ‡æ­£å¸¸ï¼Œè¡¨ç¤ºä¿®å¤æˆåŠŸã€‚
ğŸ“‹ å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨
ç›®çš„	å‘½ä»¤
æŸ¥çœ‹ IP åœ°å€	ip addr
æŸ¥çœ‹ NetworkManager è®¾å¤‡çŠ¶æ€	nmcli device status
æŸ¥çœ‹ NetworkManager æœåŠ¡çŠ¶æ€	systemctl status NetworkManager
é‡å¯ NetworkManager	sudo systemctl restart NetworkManager
ä¿®æ”¹ NetworkManager çŠ¶æ€æ–‡ä»¶	sudo sed -i 's/NetworkingEnabled=false/NetworkingEnabled=true/' /var/lib/NetworkManager/NetworkManager.state
åº”ç”¨ Netplan é…ç½®	sudo netplan apply
å¯åŠ¨ systemd-networkd	sudo systemctl start systemd-networkd
æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ï¼ˆNetworkManagerï¼‰	journalctl -u NetworkManager -f
Windows æŸ¥çœ‹æ‰€æœ‰æ¥å£ IP	ipconfig /all
Windows æŸ¥çœ‹è·¯ç”±è¡¨	route print -4
æç¤ºï¼šå¦‚æœä¸‹æ¬¡é‡åˆ°ç±»ä¼¼é—®é¢˜ï¼Œå¯ä»¥ä»æ­¥éª¤ 1 å¼€å§‹é€æ­¥æ’æŸ¥ï¼Œé€šå¸¸å¤§éƒ¨åˆ†é—®é¢˜å‡ºåœ¨ VMware æ¡¥æ¥ç½‘å¡é€‰æ‹©é”™è¯¯ã€NetworkManager çŠ¶æ€æ–‡ä»¶ æˆ– Windows é˜²ç«å¢™/å¤šæ¥å£å†²çª ä¸Šã€‚ç¥ä½ ç½‘ç»œç•…é€šæ— é˜»ï¼ ğŸš€