# 虚拟机网络模式学习笔记

## 核心概念速览
虚拟机网络模式决定了虚拟机（Guest OS）如何与宿主机（Host）、局域网乃至互联网进行通信。以下是几种核心模式的快速对比：

| 网络模式 | 虚拟机 ↔ 宿主机 | 虚拟机 ↔ 同局域网其他设备 | 虚拟机 ↔ 互联网 | 主要应用场景 |
| --- | --- | --- | --- | --- |
| 桥接模式 | ✅ 可 | ✅ 可（作为独立设备） | ✅ 可 | 为虚拟机提供独立网络身份，搭建对外服务 |
| NAT模式 | ✅ 可 | ❌ 不可 | ✅ 可（共享宿主机IP） | 最常见，仅需虚拟机访问外网 |
| 仅主机模式 | ✅ 可 | ❌ 不可 | ❌ 不可 | 宿主机与虚拟机私有网络，安全测试/文件共享 |
| 内部网络 | ❌ 不可 | ✅ 可（虚拟机之间） | ❌ 不可 | 与宿主机完全隔离的虚拟机集群 |
| NAT网络 | ❌ 不可 | ❌ 不可 | ✅ 可（通过宿主机） | 一组虚拟机共享连接访问外网，彼此与宿主机网络隔离 |

## 桥接模式 (Bridged)
- 原理：虚拟机网卡直接接入宿主机的物理网卡所在网络，像插入一台新电脑
- IP地址：从路由器/DHCP获取与宿主机同网段的独立IP
- 对外表现：局域网其他设备可直接访问虚拟机
- 视频补充笔记：________________

## NAT模式 (Network Address Translation)
- 原理：虚拟机的请求被转换为宿主机IP发出，返回再转换回虚拟机
- IP地址：虚拟机在私有网络中，由虚拟化软件DHCP分配；宿主机充当网关
- 对外表现：虚拟机可上网，外界无法直接访问虚拟机
- 视频补充笔记：________________

## 仅主机模式 (Host-Only)
- 原理：宿主机上创建虚拟网卡，宿主机与虚拟机连接到该私有网络
- 连接性：宿主机与虚拟机互通，与局域网/互联网完全隔绝
- 典型用途：病毒分析、网络安全实验
- 视频补充笔记：________________

## 内部网络 (Internal)
- 原理：创建完全隔离的虚拟机内部网络，宿主机不参与
- 连接性：同一内部网络名称的虚拟机互通；不能访问宿主机和外网
- 区别：与仅主机不同，宿主机完全不在网络内
- 视频补充笔记：________________

## NAT网络 (NAT Network)
- 原理：NAT模式的扩展，创建命名的NAT网络，多台虚拟机接入
- 连接性：同一NAT网络的虚拟机互通，并共享NAT访问外网；宿主机默认无法直接访问它们
- 适用场景：一组虚拟机协作并上网（如分布式服务器集群）
- 视频补充笔记：________________

## 对比：NAT vs 桥接
| 对比项 | NAT模式 | 桥接模式 |
| --- | --- | --- |
| 网络身份 | 共享宿主机公网身份 | 独立设备身份 |
| IP分配 | 私有网段，由虚拟化DHCP分配 | 局域网DHCP分配，与宿主机同网段 |
| 局域网可见性 | 局域网设备不可直接访问 | 局域网设备可直接访问 |
| 端口转发 | 需手动端口映射才能外部访问 | 不需要，虚拟机直接暴露服务 |
| 安全性 | 对外更隐蔽，默认入站阻断 | 对外可见，需要防火墙加固 |
| 常见用途 | 上网、开发环境、下载更新 | 搭建服务、受局域网访问 |

## 总结与选择建议
- 只让虚拟机上网、下载更新：选 NAT模式
- 让虚拟机当服务器被局域网访问：选 桥接模式
- 模拟与外界隔绝的局域网：选 内部网络 或 NAT网络
- 安全测试且不联网：选 仅主机模式


实验错误
1.在VM虚拟机下，一定要用指定的物理网卡，不要选自动
# 📝 整个排查过程回顾
## VMware 网络编辑器调整

## 以管理员身份运行，还原默认设置，确保 VMnet0 桥接到正确的物理无线网卡（而非“自动”）。

## 虚拟机内网络配置

### 最初 NetworkManager 因状态文件 NetworkingEnabled=false 而拒绝管理网卡 → 修改为 true 后仍无效。

最终选择绕过 NetworkManager，直接用 Netplan + systemd-networkd 配置静态 IP，稳定可靠。

### 主机防火墙与多接口问题

即使虚拟机配置正确，主机防火墙或多余的同网段接口也会阻挡 ping。

最终通过关闭防火墙或添加 ICMP 规则、禁用多余虚拟网卡，实现互通。